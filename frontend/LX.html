<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LX | Logic X-ray | Titanium Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cyan-glow: #00f2ff;
            --ice-blue: #a2e9ff;
            --glass-core: rgba(5, 15, 25, 0.95);
            --border-ice: rgba(0, 242, 255, 0.3);
            --error-red: #ff3e3e;
        }

        body { 
            font-family: 'Rajdhani', sans-serif; 
            background: transparent; color: #fff; 
            margin: 0; padding: 20px; direction: ltr;
        }

        .lx-header {
            text-align: center; margin-bottom: 25px;
            border-bottom: 1px solid var(--border-ice);
            padding-bottom: 15px; position: relative;
        }

        .lx-header h1 {
            font-family: 'Orbitron'; font-size: 1.2rem;
            color: var(--cyan-glow); letter-spacing: 6px; margin: 0;
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.5);
        }

        .analysis-box {
            background: var(--glass-core);
            backdrop-filter: blur(25px);
            border: 1px solid var(--border-ice);
            border-radius: 20px; padding: 25px;
            margin-bottom: 30px; line-height: 1.8;
            font-size: 1.1rem; color: var(--ice-blue);
            box-shadow: inset 0 0 20px rgba(0, 242, 255, 0.05);
        }

        .logic-grid {
            display: grid; grid-template-columns: 1fr; gap: 20px;
        }

        .logic-card {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(0, 242, 255, 0.1);
            border-radius: 15px; padding: 20px;
            position: relative; transition: 0.4s;
        }

        .logic-card:focus-within {
            border-color: var(--cyan-glow);
            background: rgba(0, 242, 255, 0.05);
            transform: translateY(-2px);
        }

        .logic-card label {
            display: block; font-family: 'Orbitron'; font-size: 10px;
            color: var(--cyan-glow); margin-bottom: 12px;
            letter-spacing: 2px; opacity: 0.8;
        }

        .cell-group {
            display: flex; gap: 10px; flex-wrap: wrap;
        }

        .logic-input {
            flex: 1; min-width: 140px;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px; color: #fff;
            padding: 12px; font-family: 'Rajdhani';
            font-size: 1rem; outline: none; transition: 0.3s;
        }

        .logic-input:focus {
            border-color: var(--cyan-glow);
            box-shadow: 0 0 10px rgba(0, 242, 255, 0.2);
        }

        .error-flash { border-color: var(--error-red) !important; animation: pulseRed 0.5s; }
        @keyframes pulseRed { 50% { border-color: white; transform: scale(1.02); } }
    </style>
</head>
<body>

    <div class="lx-header">
        <h1 id="lx-title">LOGIC X-RAY: MISSION 01</h1>
        <p style="font-size: 9px; color: #558; margin-top: 5px; letter-spacing: 2px;">DECONSTRUCTING SYNTAX STRUCTURE</p>
    </div>

    <div class="analysis-box" id="lx-passage">Initializing Neural Scan...</div>

    <div class="logic-grid" id="lx-fields"></div>

<script>
const lxData = {
    "1": {
        passage: "Although the weather was extremely cold, the determined explorers continued their journey toward the North Pole.",
        tasks: [
            { label: "Identify Contrast Marker", count: 1, placeholder: "Connector..." },
            { label: "Subject of Main Clause", count: 1, placeholder: "The..." },
            { label: "Adverb of Degree", count: 1, placeholder: "How cold?..." },
            { label: "Target Destination", count: 2, placeholder: "Where?..." }
        ]
    },
    "2": {
        passage: "The scientist discovered that the rare element reacted violently when it was exposed to direct sunlight.",
        tasks: [
            { label: "Discovery Subject", count: 1, placeholder: "Who?..." },
            { label: "Core Element", count: 2, placeholder: "Adjective + Noun..." },
            { label: "Reaction Description", count: 1, placeholder: "Adverb..." },
            { label: "Triggering Condition", count: 2, placeholder: "Exposed to..." }
        ]
    }
    // يمكن إضافة مهام أكثر بنفس الهيكلية
};

const urlParams = new URLSearchParams(window.location.search);
const taskNum = urlParams.get('task') || "1";

function loadLX() {
    const data = lxData[taskNum] || lxData["1"];
    document.getElementById('lx-passage').innerText = data.passage;
    document.getElementById('lx-title').innerText = `LOGIC X-RAY: MISSION ${taskNum.padStart(2, '0')}`;
    
    const grid = document.getElementById('lx-fields');
    grid.innerHTML = data.tasks.map((t, i) => {
        let inputs = '';
        for(let j=0; j<t.count; j++) {
            inputs += `<input type="text" class="logic-input lx-field" placeholder="${t.placeholder}" autocomplete="off">`;
        }
        return `
            <div class="logic-card" id="card-${i}">
                <label>LOGIC_NODE_0${i+1}: ${t.label}</label>
                <div class="cell-group">${inputs}</div>
            </div>
        `;
    }).join('');
}

window.addEventListener('message', function(event) {
    if (event.data.type === 'REQUEST_MISSION_DATA') {
        collectLXData();
    }
});

function collectLXData() {
    const cards = document.querySelectorAll('.logic-card');
    let results = [];
    let incomplete = false;

    cards.forEach(card => {
        const inputs = card.querySelectorAll('.lx-field');
        let cardVals = [];
        inputs.forEach(input => {
            const val = input.value.trim();
            if(!val) {
                incomplete = true;
                card.classList.add('error-flash');
                setTimeout(() => card.classList.remove('error-flash'), 600);
            }
            cardVals.push(val);
        });
        results.push(cardVals.join(' '));
    });

    if(incomplete) {
        window.parent.postMessage({ type: 'MISSION_INCOMPLETE' }, '*');
        return;
    }

    window.parent.postMessage({
        type: 'MISSION_ANSWERS',
        activityCode: 'LX',
        answers: results.join('|'),
        missionNum: taskNum
    }, '*');
}

window.onload = loadLX;
</script>
</body>
</html>
