<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GX | Word Extractor | Titanium Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #D4AF37;
            --gold-glow: rgba(212, 175, 55, 0.4);
            --glass: rgba(10, 10, 15, 0.9);
            --glass-border: rgba(212, 175, 55, 0.25);
            --error-red: #ff4444;
            --emerald-spot: rgba(0, 255, 0, 0.05);
        }

        /* 1. Text Selection Magic */
        ::selection {
            background: var(--gold);
            color: #000;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: transparent;
            color: #fff;
            margin: 0; padding: 15px;
            direction: ltr;
        }

        .header-gx {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; border-bottom: 1px solid var(--glass-border);
            padding-bottom: 15px;
        }

        .header-gx h1 {
            font-family: 'Orbitron'; font-size: 1.1rem;
            color: var(--gold); letter-spacing: 4px; margin: 0;
            text-transform: uppercase;
        }

        .passage-box {
            background: var(--glass);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 22px; border-radius: 20px;
            margin-bottom: 25px; line-height: 1.8;
            font-size: 1rem; color: #f0f0f0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border-left: 5px solid var(--gold);
            text-align: justify;
            /* Enable Selection */
            user-select: text; 
            -webkit-user-select: text;
        }

        .extractor-grid {
            display: grid; grid-template-columns: 1fr; gap: 18px;
        }

        .extraction-card {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--glass-border);
            padding: 18px; border-radius: 15px;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .extraction-card label {
            display: block; font-family: 'Orbitron'; font-size: 10px;
            color: var(--gold); margin-bottom: 12px;
            letter-spacing: 2px;
            transition: color 0.3s;
        }

        .inputs-container {
            display: flex; flex-wrap: wrap; gap: 10px;
        }

        .gx-input {
            flex: 1; min-width: 140px;
            background: rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
            color: #fff; padding: 10px 14px;
            font-family: 'Poppins'; font-size: 0.9rem;
            outline: none; transition: 0.5s;
        }

        .gx-input:focus { 
            border-color: var(--gold); 
            background: rgba(212, 175, 55, 0.08);
            box-shadow: 0 0 10px var(--gold-glow);
        }

        /* 2. Input Feedback: Target Spotted */
        .gx-input:not(:placeholder-shown) {
            background: var(--emerald-spot);
            border-color: rgba(0, 255, 0, 0.2);
        }

        /* 3. Validation Visuals */
        .error-card { 
            border-color: var(--error-red) !important; 
            animation: criticalShake 0.4s ease-in-out; 
        }

        .error-card label {
            color: var(--error-red) !important;
            animation: pulseRed 0.8s infinite;
        }

        @keyframes criticalShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-8px); }
            40% { transform: translateX(8px); }
            60% { transform: translateX(-4px); }
            80% { transform: translateX(4px); }
        }

        @keyframes pulseRed {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>

<div class="gx-container">
    <div class="header-gx">
        <h1 id="task-title">Grammar Extractor</h1>
        <div class="principle-tags"><span style="font-family:'Orbitron'; font-size:8px; color:var(--gold); border:1px solid var(--glass-border); padding:2px 6px; border-radius:4px;">TITANIUM ANALYSIS</span></div>
    </div>

    <div class="passage-box" id="passage-content">Loading Mission Data...</div>
    <div class="extractor-grid" id="extractor-fields"></div>
</div>

<script>
    // ... [Data Object GXData remains the same as provided] ...
    const gxData = {
        "1": {
            passage: "The dedicated teacher walked slowly into the bright classroom yesterday. She carried many heavy books and placed them carefully on the wooden desk. The young students were sitting quietly because they wanted to learn a new lesson. Outside, the warm sun shone through the large windows while a small bird sang a beautiful song. A curious boy raised his hand and asked a difficult question about the ancient pyramids. The teacher smiled happily and explained the answer clearly. Everyone felt very excited about the trip tomorrow. They packed their bags quickly and prepared for the long journey. It was a wonderful day for everyone in the school.",
            requirements: [
                { label: "Extract all Nouns", count: 5 },
                { label: "Extract all Adjectives", count: 5 },
                { label: "Extract all Past Simple Verbs", count: 5 },
                { label: "Extract all Adverbs", count: 5 },
                { label: "Extract all Prepositions", count: 5 }
            ]
        },
        // [Other missions 2-10 are omitted for brevity but should be included in your file]
    };

    const urlParams = new URLSearchParams(window.location.search);
    const taskNum = urlParams.get('task') || "1";

    function loadExtractor() {
        const data = gxData[taskNum] || gxData["1"];
        document.getElementById('passage-content').innerText = data.passage;
        document.getElementById('task-title').innerText = `GX: SCAN ${taskNum.padStart(2, '0')}`;
        
        const grid = document.getElementById('extractor-fields');
        grid.innerHTML = data.requirements.map((req, i) => {
            let inputsHtml = '';
            for(let j=0; j < req.count; j++) {
                inputsHtml += `<input type="text" class="gx-input" placeholder="Target ${j+1}..." autocomplete="off">`;
            }
            return `
                <div class="extraction-card" id="card-${i}">
                    <label id="label-${i}">DATA_CORE_0${i+1}: ${req.label}</label>
                    <div class="inputs-container">${inputsHtml}</div>
                </div>
            `;
        }).join('');
    }

    window.addEventListener('message', function(event) {
        if (event.data.type === 'REQUEST_MISSION_DATA') {
            collectAndSend();
        }
    });

    function collectAndSend() {
        const cards = document.querySelectorAll('.extraction-card');
        let answersArray = [];
        let globalError = false;

        cards.forEach((card, index) => {
            const inputs = card.querySelectorAll('.gx-input');
            let groupAnswers = [];
            let cardHasError = false;

            inputs.forEach(input => {
                const val = input.value.trim();
                if(!val) {
                    cardHasError = true;
                    globalError = true;
                }
                groupAnswers.push(val);
            });

            if(cardHasError) {
                card.classList.add('error-card');
                setTimeout(() => card.classList.remove('error-card'), 2000);
            } else {
                card.classList.remove('error-card');
            }
            
            answersArray.push(groupAnswers.join(',')); 
        });

        if(globalError) {
            window.parent.postMessage({ type: 'MISSION_INCOMPLETE' }, '*');
            return;
        }

        window.parent.postMessage({ 
            type: 'MISSION_ANSWERS', 
            activityCode: 'GRX',
            answers: answersArray,
            missionNum: taskNum
        }, '*');
    }

    window.onload = loadExtractor;
</script>
</body>
</html>
