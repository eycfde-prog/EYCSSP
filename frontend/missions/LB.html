<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Label Master | Visual Intelligence | Titanium Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
<style>
    /* ... Ù†ÙØ³ Ø§Ù„Ø§Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù‚Ø¯ÙŠÙ… Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ· Ù‡Ù†Ø§ ... */
    .img-container {
        width: 100%; height: 120px; /* ÙƒØ¨Ø±Ù†Ø§ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø´ÙˆÙŠØ© */
        background: #000; /* Ø®Ù„ÙÙŠØ© Ø³ÙˆØ¯Ø© ØµØ±ÙŠØ­Ø© */
        border-radius: 12px;
        margin-bottom: 15px;
        display: flex; align-items: center; justify-content: center;
        border: 1px solid var(--neon-blue);
        overflow: hidden;
    }

    .img-container img {
        width: 100%; height: 100%; /* Ø®Ù„ÙŠ Ø§Ù„ØµÙˆØ±Ø© ØªÙ…Ù„Ø£ Ø§Ù„Ù…ÙƒØ§Ù† */
        object-fit: cover; /* Ø£Ùˆ contain Ø­Ø³Ø¨ Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø´ÙƒÙ„ Ø§Ù„ØµÙˆØ± */
        display: block;
    }
</style>

<script>
    // ... Ù†ÙØ³ Ø§Ù„Ù…ØµÙÙˆÙØ© ÙˆØ§Ù„Ù€ urlParams ...

    function loadLabelMission() {
        const currentTask = labelData[taskNum.toString()] || labelData["1"];
        document.getElementById('topic-title').innerText = `SEC: ${currentTask.topic}`;
        const container = document.getElementById('label-zone');
        container.innerHTML = ""; // Ù†Ù…Ø³Ø­ Ø§Ù„Ù‚Ø¯ÙŠÙ… ØªÙ…Ø§Ù…Ø§Ù‹

        const repoBase = "https://raw.githubusercontent.com/eycfde-prog/EYCSSP/main/frontend/eyclogs/";

        for (let i = 0; i < 10; i++) {
            const imgID = ((taskNum - 1) * 10) + (i + 1);
            const imgSrc = `${repoBase}${imgID}.png`;

            const card = document.createElement('div');
            card.className = "image-card";
            card.id = `card-${i}`;
            card.innerHTML = `
                <div class="img-container" onclick="openZoom('${imgSrc}')">
                    <img src="${imgSrc}" 
                         id="img-tag-${i}"
                         onload="console.log('âœ… VISIBLE: ID ${imgID}')" 
                         onerror="githubFallback(this, ${imgID})">
                </div>
                <input type="text" class="label-input" id="label-${i}" placeholder="IDENTIFY..." autocomplete="off">
            `;
            container.appendChild(card);
        }
    }

    function githubFallback(img, id) {
        const repoBase = "https://raw.githubusercontent.com/eycfde-prog/EYCSSP/main/frontend/eyclogs/";
        if (img.src.includes('.png')) {
            img.src = `${repoBase}${id}.jpg`;
        } else if (img.src.includes('.jpg')) {
            img.src = `${repoBase}${id}.PNG`;
        } else {
            img.onerror = null;
            img.src = "https://placehold.jp/24/00f2ff/000000/150x150.png?text=ERROR";
        }
    }
    // ... Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¯ÙˆØ§Ù„ (openZoom, collectData) ...
</script>
</head>
<body>

    <div id="topic-title" class="topic-header">SCANNING DATA...</div>
    <div id="label-zone" class="label-grid"></div>

    <div id="zoom-overlay" onclick="closeZoom()">
        <button class="close-zoom">BACK</button>
        <img id="zoomed-img" src="" alt="Zoomed View">
    </div>

<script>
    const labelData = {
        "1": { topic: "Kitchen Tech" }, "2": { topic: "Animal Kingdom" },
        "3": { topic: "Office HQ" }, "4": { topic: "Nature & Veggies" },
        "5": { topic: "Medical Lab" }, "6": { topic: "Expedition Gear" },
        "7": { topic: "Occupations" }, "8": { topic: "Transport" },
        "9": { topic: "Fashion Specs" }, "10": { topic: "Music Studio" }
    };

    const urlParams = new URLSearchParams(window.location.search);
    const taskNum = parseInt(urlParams.get('task')) || 1;

function loadLabelMission() {
    const currentTask = labelData[taskNum.toString()] || labelData["1"];
    document.getElementById('topic-title').innerText = `SEC: ${currentTask.topic}`;
    const container = document.getElementById('label-zone');
    let html = '';

    // Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹ (ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹)
    const repoBase = "https://raw.githubusercontent.com/eycfde-prog/EYCSSP/main/frontend/eyclogs/";

    for (let i = 0; i < 10; i++) {
        const imgID = ((taskNum - 1) * 10) + (i + 1);
        
        // Ù‡Ù†Ø¬Ø±Ø¨ Ø§Ù„Ù€ png Ø£ÙˆÙ„ Ø­Ø§Ø¬Ø© Ù…Ù† Ù„ÙŠÙ†Ùƒ Ø§Ù„Ù€ Raw Ø¨ØªØ§Ø¹ Ø¬ÙŠØª Ù‡Ø§Ø¨
        const imgSrc = `${repoBase}${imgID}.png`;

        html += `
            <div class="image-card" id="card-${i}">
                <div class="img-container" onclick="openZoom(this.querySelector('img').src)">
                    <img src="${imgSrc}" 
                         data-id="${imgID}"
                         onload="console.log('ğŸ”¥ BINGO! ID ' + ${imgID})"
                         onerror="githubFallback(this)">
                </div>
                <input type="text" class="label-input" id="label-${i}" placeholder="IDENTIFY..." autocomplete="off">
            </div>
        `;
    }
    container.innerHTML = html;
}

function githubFallback(img) {
    const id = img.dataset.id;
    const repoBase = "https://raw.githubusercontent.com/eycfde-prog/EYCSSP/main/frontend/eyclogs/";
    
    if (!img.dataset.failcount) img.dataset.failcount = "0";
    let fail = parseInt(img.dataset.failcount);

    if (fail === 0) {
        img.dataset.failcount = "1";
        img.src = `${repoBase}${id}.jpg`; // Ø¬Ø±Ø¨ jpg
    } else if (fail === 1) {
        img.dataset.failcount = "2";
        img.src = `${repoBase}${id}.PNG`; // Ø¬Ø±Ø¨ PNG ÙƒØ¨ÙŠØ±Ø©
    } else {
        img.onerror = null;
        img.src = "https://placehold.jp/24/00f2ff/000000/150x150.png?text=NOT_FOUND";
    }
}
    function openZoom(src) {
        document.getElementById('zoomed-img').src = src;
        document.getElementById('zoom-overlay').style.display = 'flex';
    }

    function closeZoom() {
        document.getElementById('zoom-overlay').style.display = 'none';
    }

    function collectData() {
        const studentAnswers = [];
        let missing = false;
        for(let i=0; i<10; i++) {
            const el = document.getElementById(`label-${i}`);
            const val = el.value.trim();
            if(!val) {
                missing = true;
                document.getElementById(`card-${i}`).classList.add('error-card');
                setTimeout(()=> document.getElementById(`card-${i}`).classList.remove('error-card'), 500);
            }
            studentAnswers.push(val);
        }
        if(missing) {
            window.parent.postMessage({ type: 'MISSION_INCOMPLETE' }, '*');
            return;
        }
        window.parent.postMessage({
            type: 'MISSION_ANSWERS',
            activityCode: 'LB',
            answers: studentAnswers,
            task: taskNum.toString()
        }, '*');
    }

    window.addEventListener('message', (e) => {
        if (e.data.type === 'REQUEST_MISSION_DATA') collectData();
    });

    window.onload = loadLabelMission;
</script>
</body>
</html>
