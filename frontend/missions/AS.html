<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Alike Mission | Titanium Viewport</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Poppins:wght@300;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --gold: #C5A028; 
            --gold-glow: rgba(197, 160, 40, 0.4);
            --glass: rgba(255, 255, 255, 0.03); 
            --glass-border: rgba(197, 160, 40, 0.15);
            --cyan: #00f2ff;
        }
        
        body { 
            font-family: 'Poppins', sans-serif; 
            background: transparent; 
            color: white; 
            margin: 0; 
            padding: 20px 10px; 
            min-height: 100vh;
            overflow-x: hidden;
            direction: ltr;
        }

        body::-webkit-scrollbar { width: 3px; }
        body::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; }

        .mission-container { 
            animation: fadeIn 0.8s ease-out; 
            max-width: 900px;
            margin: 0 auto;
        }

        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(15px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        .secret-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding: 0 10px;
        }

        .principle-tag {
            font-family: 'Orbitron'; font-size: 9px; color: var(--gold);
            border: 1px solid var(--glass-border); padding: 3px 8px; border-radius: 4px;
            background: rgba(0,0,0,0.5); letter-spacing: 1px;
        }

        .alike-grid {
            display: grid; grid-template-columns: 1fr; gap: 20px;
        }

        @media (min-width: 650px) {
            .alike-grid { grid-template-columns: 1fr 1fr; }
        }

        .pair-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(0,0,0,0.2) 100%);
            backdrop-filter: blur(5px);
            border: 1px solid var(--glass-border); 
            padding: 30px 15px 15px; 
            position: relative;
            transition: all 0.3s ease;
            border-radius: 12px;
        }
        
        .pair-card:hover { 
            border-color: var(--gold); 
            box-shadow: 0 0 20px var(--gold-glow);
            transform: translateY(-3px);
        }

        .case-tag {
            position: absolute; 
            top: -10px;
            left: 15px; 
            background: var(--gold);
            color: #000; 
            font-family: 'Orbitron'; 
            font-size: 10px; padding: 2px 10px; 
            border-radius: 4px; font-weight: 900;
            letter-spacing: 1px;
            box-shadow: 0 0 10px var(--gold-glow); /* Titanium Glow */
        }

        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        
        label { 
            font-family: 'Noto Sans Arabic', sans-serif;
            font-size: 14px; 
            color: #aaa; 
            font-weight: 700; 
            margin-bottom: 8px;
            text-align: center; 
            display: block; 
        }

        .word-box { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
        }

        .alike-input {
            width: 100%; 
            background: rgba(0, 0, 0, 0.6); 
            border: 1px solid var(--glass-border);
            border-radius: 8px; 
            padding: 12px; 
            color: var(--gold); 
            text-align: center;
            font-family: 'Orbitron', sans-serif; 
            font-size: 13px; 
            font-weight: 600;
            outline: none; 
            transition: 0.3s;
            text-transform: uppercase; /* Input Refinement */
        }

        .alike-input:focus { 
            border-color: var(--gold); 
            background: rgba(212, 175, 55, 0.1);
            box-shadow: 0 0 15px var(--gold-glow);
        }

        .alike-input.error { border-color: #ff4444 !important; animation: shake 0.4s; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .sync-indicator {
            font-size: 8px; font-family: 'Orbitron'; color: #444;
            margin-top: 10px; text-transform: uppercase;
            text-align: center; letter-spacing: 1px;
            transition: 0.3s;
        }
    </style>
</head>
<body>

    <div class="mission-container">
        <div class="secret-header">
            <div class="principle-tag"><i class="fas fa-microchip"></i> FREQUENCY DECODER</div>
            <div style="display: flex; gap: 5px;">
                <span class="principle-tag">TITANIUM</span>
                <span class="principle-tag" id="task-id">AS-01</span>
            </div>
        </div>

        <div id="mission-wrapper"></div>
    </div>

<script>
    const missionsData = {
        "1": [ {a:"شمس", b:"ابن"}, {a:"بحر", b:"يرى"}, {a:"إلى", b:"أيضاً"}, {a:"هنا", b:"يسمع"}, {a:"لا", b:"يعرف"} ],
        "2": [ {a:"نفخ", b:"أزرق"}, {a:"دقيق", b:"زهرة"}, {a:"فارس", b:"ليل"}, {a:"يكتب", b:"يمين"}, {a:"كامل", b:"ثقب"} ],
        "3": [ {a:"ينتظر", b:"وزن"}, {a:"كسر", b:"فرامل"}, {a:"أسبوع", b:"ضعيف"}, {a:"سنت", b:"أرسل"}, {a:"درجة سلم", b:"نظرة"} ],
        "4": [ {a:"يشتري", b:"بواسطة"}, {a:"أرنب", b:"شعر"}, {a:"سمع", b:"قطيع"}, {a:"وريث", b:"هواء"}, {a:"فاز", b:"واحد"} ],
        "5": [ {a:"يقابل", b:"لحم"}, {a:"طريق", b:"ركب"}, {a:"مشهد", b:"مرئي"}, {a:"لوح", b:"ملل"}, {a:"ذيل", b:"قصة"} ],
        "6": [ {a:"كمثرى", b:"زوج"}, {a:"رئيسي", b:"عرف الأسد"}, {a:"قطعة", b:"سلام"}, {a:"ذكر", b:"بريد"}, {a:"فولاذ", b:"يسرق"} ],
        "7": [ {a:"خادمة", b:"صنع"}, {a:"سهل/واضح", b:"طائرة"}, {a:"نفايات", b:"خصر"}, {a:"عزيزي", b:"غزال"}, {a:"خشب", b:"سوف"} ],
        "8": [ {a:"توت", b:"يدفن"}, {a:"جذر", b:"طريق"}, {a:"إبحار", b:"تخفيض"}, {a:"إصبع", b:"يسحب"}, {a:"يشفى", b:"كعب"} ],
        "9": [ {a:"مسموح", b:"بصوت عال"}, {a:"يكون", b:"نحلة"}, {a:"قبو", b:"بائع"}, {a:"يموت", b:"صبغة"}, {a:"ضيف", b:"خمن"} ],
        "10": [ {a:"صباح", b:"حداد"}, {a:"أنف", b:"يعرف (للمفرد)"}, {a:"باهت", b:"دلو"}, {a:"وردة", b:"صفوف"}, {a:"رمى", b:"خلال"} ]
    };

    let typingTimer;

    function renderActiveMission() {
        const urlParams = new URLSearchParams(window.location.search);
        const taskNum = urlParams.get('task') || "1"; 
        document.getElementById('task-id').innerText = `AS-${taskNum.padStart(2, '0')}`;
        const pairs = missionsData[taskNum] || missionsData["1"];
        
        const wrapper = document.getElementById('mission-wrapper');
        wrapper.innerHTML = `
            <div class="alike-grid">
                ${pairs.map((p, i) => `
                    <div class="pair-card">
                        <span class="case-tag">UNIT ${String(i+1).padStart(2, '0')}</span>
                        <div class="input-row">
                            <div class="word-box">
                                <label>${p.a}</label>
                                <input type="text" class="alike-input" data-id="p${i}a" placeholder="...">
                            </div>
                            <div class="word-box">
                                <label>${p.b}</label>
                                <input type="text" class="alike-input" data-id="p${i}b" placeholder="...">
                            </div>
                        </div>
                        <div class="sync-indicator">SIGNAL STATUS: WAITING</div>
                    </div>
                `).join('')}
            </div>
        `;

        attachEventListeners();
        loadPersistedData();
    }

    function attachEventListeners() {
        const inputs = document.querySelectorAll('.alike-input');
        inputs.forEach(input => {
            // 1. Input Refinement & Analysis Logic
            input.addEventListener('input', function() {
                const indicator = this.closest('.pair-card').querySelector('.sync-indicator');
                indicator.innerText = "ANALYZING FREQUENCY...";
                indicator.style.color = "var(--gold)";

                clearTimeout(typingTimer);
                typingTimer = setTimeout(() => {
                    if(this.value.trim() !== "") {
                        indicator.innerText = "FREQUENCY LOCKED";
                        indicator.style.color = "#00f2ff";
                    } else {
                        indicator.innerText = "SIGNAL STATUS: WAITING";
                        indicator.style.color = "#444";
                    }
                }, 500);
            });

            // 2. Auto-Persistence on Change
            input.addEventListener('change', function() {
                const taskNum = new URLSearchParams(window.location.search).get('task') || "1";
                const storageKey = `as_mission_t${taskNum}`;
                let currentData = JSON.parse(sessionStorage.getItem(storageKey) || "{}");
                currentData[this.dataset.id] = this.value;
                sessionStorage.setItem(storageKey, JSON.stringify(currentData));
            });
        });
    }

    function loadPersistedData() {
        const taskNum = new URLSearchParams(window.location.search).get('task') || "1";
        const savedData = JSON.parse(sessionStorage.getItem(`as_mission_t${taskNum}`) || "{}");
        Object.keys(savedData).forEach(id => {
            const input = document.querySelector(`[data-id="${id}"]`);
            if(input) {
                input.value = savedData[id];
                const indicator = input.closest('.pair-card').querySelector('.sync-indicator');
                indicator.innerText = "FREQUENCY LOCKED";
                indicator.style.color = "#00f2ff";
            }
        });
    }

    window.addEventListener('message', function(event) {
        if (event.data.type === 'REQUEST_MISSION_DATA') collectAndSend();
    });

    function collectAndSend() {
        const urlParams = new URLSearchParams(window.location.search);
        const taskNum = urlParams.get('task') || "1";
        const inputs = document.querySelectorAll('.alike-input');
        let answersArray = [];
        let hasError = false;

        inputs.forEach(input => {
            const val = input.value.trim().toUpperCase(); // Data Sanitization
            if(!val) {
                hasError = true;
                input.classList.add('error');
                setTimeout(() => input.classList.remove('error'), 1000);
            } else {
                answersArray.push(val);
            }
        });

        if(hasError) return;

        // Final Protocol Transmission
        window.parent.postMessage({
            type: 'MISSION_ANSWERS', 
            activityCode: 'AS', 
            task: taskNum, 
            answers: answersArray 
        }, '*');
    }

    window.onload = renderActiveMission;
</script>
</body>
</html>
